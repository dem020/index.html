<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞—Å—Å–∞ - –í–∫—É—Å –°–°–°–†</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#d32f2f">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #d32f2f;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #e57373;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background-color: #c62828;
    }
    .filters {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .filters button.active {
      background: #c62828;
    }
    .products-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }
    .cart, .customer-info {
      background: #fafafa;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      padding: 5px 0;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üõí –ö–∞—Å—Å–∞ "–í–∫—É—Å –°–°–°–†"</h1>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –≤—Ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div id="loginScreen">
      <h3>–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞:</h3>
      <input type="text" id="phoneInput" placeholder="+7 (___) ___-__-__" />
      <button onclick="loginCustomer()">–í–æ–π—Ç–∏</button>
      <button onclick="showRegisterForm()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ</button>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerForm" style="display: none;">
      <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h3>
      <input type="text" id="newName" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" />
      <input type="text" id="newPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
      <button onclick="registerCustomer()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ -->
    <div class="customer-info" id="customerInfo" style="display: none;">
      <p><strong>–ò–º—è:</strong> <span id="customerName"></span></p>
      <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span id="customerPhone"></span></p>
      <p><strong>–ë–∞–ª–ª—ã:</strong> <span id="customerPoints">0</span></p>
      <div>
        <input type="number" id="pointsToUse" placeholder="–°–∫–æ–ª—å–∫–æ —Å–ø–∏—Å–∞—Ç—å –±–∞–ª–ª–æ–≤?" min="0" />
        <button onclick="useCustomPoints()">–°–ø–∏—Å–∞—Ç—å</button>
      </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters">
      <button onclick="showCategory('food')" class="active" data-category="food">–ü—Ä–æ–¥—É–∫—Ç—ã</button>
      <button onclick="showCategory('cigarettes')" data-category="cigarettes">–°–∏–≥–∞—Ä–µ—Ç—ã</button>
      <button onclick="showCategory('alcohol')" data-category="alcohol">–ê–ª–∫–æ–≥–æ–ª—å</button>
    </div>

    <!-- –¢–æ–≤–∞—Ä—ã -->
    <div class="products-section" id="products-container"></div>

    <!-- –ß–µ–∫ -->
    <div class="cart">
      <h2>–ß–µ–∫</h2>
      <ul id="cart-items"></ul>
      <p><strong>–ò—Ç–æ–≥–æ:</strong> <span id="total">0</span> ‚ÇΩ</p>
      <button onclick="checkout('cash')">–ù–∞–ª–∏—á–Ω—ã–º–∏</button>
      <button onclick="checkout('card')">–ö–∞—Ä—Ç–æ–π</button>
      <button onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
  </div>

  <script>
    let cart = [];
    let customers = JSON.parse(localStorage.getItem("customers")) || {};
    let currentCustomer = null;

    const productsDB = [
      // –ü—Ä–æ–¥—É–∫—Ç—ã
      { category: 'food', code: "F001", name: "–•–ª–µ–± –±–µ–ª—ã–π", price: 20 },
      { category: 'food', code: "F002", name: "–ú–æ–ª–æ–∫–æ", price: 45 },
      { category: 'food', code: "F003", name: "–Ø–π—Ü–∞", price: 60 },
      { category: 'food', code: "F004", name: "–ì—Ä–µ—á–∫–∞", price: 70 },
      { category: 'food', code: "F005", name: "–°–∞—Ö–∞—Ä", price: 80 },
      { category: 'food', code: "F006", name: "–°–æ–ª—å", price: 15 },
      { category: 'food', code: "F007", name: "–ú–∞—Å–ª–æ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–æ–µ", price: 120 },
      { category: 'food', code: "F008", name: "–¢–≤–æ—Ä–æ–≥", price: 90 },
      { category: 'food', code: "F009", name: "–°–º–µ—Ç–∞–Ω–∞", price: 55 },
      { category: 'food', code: "F010", name: "–ö–æ–ª–±–∞—Å–∞ –≤–∞—Ä–µ–Ω–∞—è", price: 250 },
      { category: 'food', code: "F011", name: "–°–æ—Å–∏—Å–∫–∏", price: 180 },
      { category: 'food', code: "F012", name: "–ö—É—Ä–∏–Ω—ã–µ –æ–∫–æ—Ä–æ—á–∫–∞", price: 190 },
      { category: 'food', code: "F013", name: "–ì–æ–≤—è–¥–∏–Ω–∞ –æ—Ç–±–∏–≤–Ω–∞—è", price: 350 },
      { category: 'food', code: "F014", name: "–§–∞—Ä—à —Å–º–µ—à–∞–Ω–Ω—ã–π", price: 280 },
      { category: 'food', code: "F015", name: "–°–æ—Å–∏—Å–∫–∏", price: 180 },
      { category: 'food', code: "F016", name: "–ö–æ–ª–±–∞—Å–∞ –¥–æ–∫—Ç–æ—Ä—Å–∫–∞—è", price: 270 },
      { category: 'food', code: "F017", name: "–ö—Ä—ã–∂–Ω–µ–≤–∏—á–∏", price: 73 },
      { category: 'food', code: "F018", name: "–ú–∞–ª—å–±–æ—Ä–æ", price: 120 },
      { category: 'food', code: "F019", name: "–ö–≠", price: 65 },
      { category: 'food', code: "F020", name: "Winston", price: 115 },
      { category: 'food', code: "F021", name: "Lucky Strike", price: 120 },
      { category: 'food', code: "F022", name: "Davidoff", price: 130 },
      { category: 'food', code: "F023", name: "Pall Mall", price: 100 },
      { category: 'food', code: "F024", name: "Camel", price: 110 },
      { category: 'food', code: "F025", name: "Parliament", price: 125 },
      { category: 'food', code: "F026", name: "Bond", price: 70 },
      { category: 'food', code: "F027", name: "–ü—Ä–∏–º–∞ –ú–µ–Ω—Ç–æ–ª", price: 73 },
      { category: 'food', code: "F028", name: "–®–æ–∫–æ–ª–∞–¥ Alenka", price: 70 },
      { category: 'food', code: "F029", name: "–ü–µ—á–µ–Ω—å–µ –Æ–±–∏–ª–µ–π–Ω–æ–µ", price: 50 },
      { category: 'food', code: "F030", name: "–ö–æ–Ω—Ñ–µ—Ç—ã –†–æ–º–∞—à–∫–∞", price: 90 },
      { category: 'food', code: "F031", name: "–°—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã 200–≥", price: 110 },

      // –ê–ª–∫–æ–≥–æ–ª—å
      { category: 'alcohol', code: "A001", name: "–ó—É–±—Ä–æ–≤–∫–∞", price: 450 },
      { category: 'alcohol', code: "A002", name: "–ö—Ä–µ–º–ª—ë–≤—Å–∫–∞—è", price: 420 },
      { category: 'alcohol', code: "A003", name: "–ê–±—Å–æ–ª—é—Ç", price: 500 },
      { category: 'alcohol', code: "A004", name: "–†—É—Å—Å–∫–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç", price: 480 },
      { category: 'alcohol', code: "A005", name: "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ—Å–æ–±–∞—è", price: 430 },
      { category: 'alcohol', code: "A006", name: "–ü—à–µ–Ω–∏—á–Ω–∞—è", price: 410 },
      { category: 'alcohol', code: "A007", name: "–ö–∏–Ω–µ—à–µ–º—Å–∫–∞—è", price: 400 },
      { category: 'alcohol', code: "A008", name: "–†—É—Å—Å–∫–∞—è –≤–æ–¥–æ—á–∫–∞", price: 390 },
      { category: 'alcohol', code: "A009", name: "–†—É—Å—å", price: 460 },
      { category: 'alcohol', code: "A010", name: "–§–∏–Ω–ª—è–Ω–¥–∏—è", price: 510 },
      { category: 'alcohol', code: "A011", name: "–î–∂–∏–Ω Beefeater", price: 1200 },
      { category: 'alcohol', code: "A012", name: "–í–∏–Ω–æ –∫—Ä–∞—Å–Ω–æ–µ –∫—Ä–µ–ø–ª—ë–Ω–æ–µ", price: 350 },
      { category: 'alcohol', code: "A013", name: "–ü–∏–≤–æ –ñ–∏–≥—É–ª—ë–≤—Å–∫–æ–µ", price: 60 },
      { category: 'alcohol', code: "A014", name: "–ü–∏–≤–æ –ö–æ–∑–µ–ª", price: 70 },
      { category: 'alcohol', code: "A015", name: "–ö–æ–Ω—å—è–∫ –ê—Ä–∞—Ä–∞—Ç 3 –∑–≤–µ–∑–¥—ã", price: 700 },
      { category: 'alcohol', code: "A016", name: "–ö–æ–Ω—å—è–∫ –ö—Ä—ã–∂–Ω–µ–≤–∏—á–∏", price: 800 },
      { category: 'alcohol', code: "A017", name: "–í–∏–Ω–æ –±–µ–ª–æ–µ —Å—É—Ö–æ–µ", price: 450 },
      { category: 'alcohol', code: "A018", name: "–í–∏–Ω–æ –∫—Ä–∞—Å–Ω–æ–µ —Å—É—Ö–æ–µ", price: 480 },
      { category: 'alcohol', code: "A019", name: "–í–∏–Ω–æ –ø–æ–ª—É—Å–ª–∞–¥–∫–æ–µ", price: 400 },
      { category: 'alcohol', code: "A020", name: "–í–æ–¥–∫–∞ –†—É—Å—å", price: 460 },

      // –°–∏–≥–∞—Ä–µ—Ç—ã
      { category: 'cigarettes', code: "C001", name: "–ë–µ–ª–æ–º–æ—Ä–∫–∞–Ω–∞–ª", price: 65 },
      { category: 'cigarettes', code: "C002", name: "–î—ã–º–æ–∫", price: 68 },
      { category: 'cigarettes', code: "C003", name: "–ö–∞–∑–±–µ–∫", price: 70 },
      { category: 'cigarettes', code: "C004", name: "–°—Ç–æ–ª–∏—á–Ω—ã–µ", price: 75 },
      { category: 'cigarettes', code: "C005", name: "–ü—Ä–∏–º–∞", price: 72 },
      { category: 'cigarettes', code: "C006", name: "–°–µ–≤–µ—Ä", price: 67 },
      { category: 'cigarettes', code: "C007", name: "–ö—É—Ä—Å–∫", price: 69 },
      { category: 'cigarettes', code: "C008", name: "–†–æ—Å—Å–∏—è ‚Ññ1", price: 74 },
      { category: 'cigarettes', code: "C009", name: "–í—ã–º–ø–µ–ª", price: 71 },
      { category: 'cigarettes', code: "C010", name: "–ö—Ä—ã–∂–Ω–µ–≤–∏—á–∏", price: 73 },
      { category: 'cigarettes', code: "C011", name: "–ú–∞–ª—å–±–æ—Ä–æ", price: 120 },
      { category: 'cigarettes', code: "C012", name: "–ö–≠", price: 65 },
      { category: 'cigarettes', code: "C013", name: "Winston", price: 115 },
      { category: 'cigarettes', code: "C014", name: "Lucky Strike", price: 120 },
      { category: 'cigarettes', code: "C015", name: "Davidoff", price: 130 },
      { category: 'cigarettes', code: "C016", name: "Pall Mall", price: 100 },
      { category: 'cigarettes', code: "C017", name: "Camel", price: 110 },
      { category: 'cigarettes', code: "C018", name: "Parliament", price: 125 },
      { category: 'cigarettes', code: "C019", name: "Bond", price: 70 },
      { category: 'cigarettes', code: "C020", name: "–ü—Ä–∏–º–∞ –ú–µ–Ω—Ç–æ–ª", price: 73 },
    ];

    function addToCart(name, price) {
      const qty = prompt(`–°–∫–æ–ª—å–∫–æ "${name}" –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å?`, "1");
      const quantity = parseInt(qty);

      if (!qty || isNaN(quantity) || quantity <= 0) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ");
        return;
      }

      for (let i = 0; i < quantity; i++) {
        cart.push({ name, price });
      }

      updateCart();
    }

    function updateCart() {
      const itemsList = document.getElementById("cart-items");
      const totalEl = document.getElementById("total");
      itemsList.innerHTML = "";
      let total = 0;

      const grouped = {};

      cart.forEach((item, index) => {
        if (!grouped[item.name]) {
          grouped[item.name] = { price: item.price, count: 0 };
        }
        grouped[item.name].count++;
      });

      Object.keys(grouped).forEach(name => {
        const info = grouped[name];
        const totalPrice = info.price * info.count;

        const li = document.createElement("li");
        li.textContent = `${name} x${info.count} ‚Äî ${totalPrice} ‚ÇΩ`;
        itemsList.appendChild(li);
        total += totalPrice;
      });

      totalEl.textContent = total;
    }

    function showRegisterForm() {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("registerForm").style.display = "block";
    }

    function registerCustomer() {
      const phone = document.getElementById("newPhone").value.trim();
      const name = document.getElementById("newName").value.trim();

      if (!phone || !name) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
        return;
      }

      if (customers[phone]) {
        alert("–ö–ª–∏–µ–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
        return;
      }

      customers[phone] = { name, points: 0, history: [] };
      localStorage.setItem("customers", JSON.stringify(customers));
      alert(`‚úÖ –ö–ª–∏–µ–Ω—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${name}, ${phone}`);
      showLoginScreen();
    }

    function showLoginScreen() {
      document.getElementById("registerForm").style.display = "none";
      document.getElementById("loginScreen").style.display = "block";
    }

    function loginCustomer() {
      const phone = document.getElementById("phoneInput").value.trim();

      if (!phone) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞");
        return;
      }

      if (customers[phone]) {
        currentCustomer = phone;
        showCustomerInfo(customers[phone]);
      } else {
        alert("–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
      }
    }

    function showCustomerInfo(data) {
      document.getElementById("customerName").textContent = data.name;
      document.getElementById("customerPhone").textContent = currentCustomer;
      document.getElementById("customerPoints").textContent = data.points;
      document.getElementById("customerInfo").style.display = "block";
    }

    function useCustomPoints() {
      const pointsToUse = parseInt(document.getElementById("pointsToUse").value);
      if (!currentCustomer) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞");

      const customer = customers[currentCustomer];

      if (isNaN(pointsToUse) || pointsToUse < 0) {
        alert("–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ");
        return;
      }

      if (customer.points >= pointsToUse && pointsToUse > 0) {
        customer.points -= pointsToUse;
        customer.history.push({
          text: `–°–ø–∏—Å–∞–Ω–∏–µ ${pointsToUse} –±–∞–ª–ª–æ–≤`,
          points: `- ${pointsToUse}`,
          date: new Date().toLocaleString()
        });

        localStorage.setItem("customers", JSON.stringify(customer));
        showCustomerInfo(customer);

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫–∏–¥–∫—É –≤ —á–µ–∫
        cart.push({
          name: `–°–∫–∏–¥–∫–∞ (${pointsToUse} –±–∞–ª–ª–æ–≤)`,
          price: -pointsToUse,
          quantity: 1,
          totalPrice: -pointsToUse
        });

        updateCart();
        alert(`‚úÖ –í—ã —Å–ø–∏—Å–∞–ª–∏ ${pointsToUse} –±–∞–ª–ª–æ–≤`);
      } else {
        alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è");
      }
    }

    function checkout(paymentMethod) {
      if (cart.length === 0) {
        alert("–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ —á–µ–∫!");
        return;
      }

      const total = cart.reduce((sum, item) => sum + item.price, 0);

      if (currentCustomer && total > 0) {
        const pointsToAdd = Math.floor(total * 0.5); // 50% –±–æ–Ω—É—Å–æ–≤
        customers[currentCustomer].points += pointsToAdd;
        customers[currentCustomer].history.push({
          text: `+ ${pointsToAdd} –±–∞–ª–ª–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫—É –Ω–∞ ${total} ‚ÇΩ`,
          points: `+ ${pointsToAdd}`,
          date: new Date().toLocaleString()
        });
        localStorage.setItem("customers", JSON.stringify(customers));
        showCustomerInfo(customers[currentCustomer]);
      }

      alert(`‚úÖ –û–ø–ª–∞—á–µ–Ω–æ ${paymentMethod === 'cash' ? '–Ω–∞–ª–∏—á–Ω—ã–º–∏' : '–∫–∞—Ä—Ç–æ–π'}!`);
      clearCart();
    }

    function clearCart() {
      cart = [];
      updateCart();
    }

    function generateProductButtons(category = 'food') {
      const container = document.getElementById("products-container");
      container.innerHTML = "";

      const filteredProducts = productsDB.filter(p => p.category === category);

      filteredProducts.forEach(product => {
        const btn = document.createElement("button");
        btn.textContent = `${product.name} ‚Äî ${product.price} ‚ÇΩ`;
        btn.onclick = () => addToCart(product.name, product.price);
        container.appendChild(btn);
      });

      document.querySelectorAll(".filters button").forEach(b => b.classList.remove("active"));
      document.querySelector(`button[data-category="${category}"]`).classList.add("active");
    }

    function showCategory(cat) {
      generateProductButtons(cat);
    }

    window.onload = () => {
      generateProductButtons("food");
    };
  </script>
</body>
</html>
