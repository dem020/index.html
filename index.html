<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞—Å—Å–∞ - –í–∫—É—Å –°–°–°–†</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#d32f2f">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #d32f2f;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #e57373;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background-color: #c62828;
    }
    .filters {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .filters button.active {
      background: #c62828;
    }
    .products-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }
    .cart, .customer-info {
      background: #fafafa;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      padding: 5px 0;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üõí –ö–∞—Å—Å–∞ "–í–∫—É—Å –°–°–°–†"</h1>

    <!-- –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div>
      <input type="text" id="phoneInput" placeholder="+7 (___) ___-__-__" />
      <button onclick="loginCustomer()">–í–æ–π—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</button>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ -->
    <div class="customer-info" id="customerInfo" style="display: none;">
      <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span id="customerPhone"></span></p>
      <p><strong>–ë–∞–ª–ª—ã:</strong> <span id="customerPoints">0</span></p>
      <button onclick="usePoints()">–°–ø–∏—Å–∞—Ç—å –±–∞–ª–ª—ã</button>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters">
      <button onclick="showCategory('food')" class="active" data-category="food">–ü—Ä–æ–¥—É–∫—Ç—ã</button>
      <button onclick="showCategory('cigarettes')" data-category="cigarettes">–°–∏–≥–∞—Ä–µ—Ç—ã</button>
      <button onclick="showCategory('alcohol')" data-category="alcohol">–ê–ª–∫–æ–≥–æ–ª—å</button>
    </div>

    <!-- –¢–æ–≤–∞—Ä—ã -->
    <div class="products-section" id="products-container"></div>

    <!-- –ß–µ–∫ -->
    <div class="cart">
      <h2>–ß–µ–∫</h2>
      <ul id="cart-items"></ul>
      <p><strong>–ò—Ç–æ–≥–æ:</strong> <span id="total">0</span> ‚ÇΩ</p>
      <button onclick="checkout('cash')">–ù–∞–ª–∏—á–Ω—ã–º–∏</button>
      <button onclick="checkout('card')">–ö–∞—Ä—Ç–æ–π</button>
      <button onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
  </div>

  <script>
    let cart = [];
    let customers = JSON.parse(localStorage.getItem("customers")) || {};
    let currentCustomer = null;

    const productsDB = [
      // –ü—Ä–æ–¥—É–∫—Ç—ã
      { category: 'food', code: "F001", name: "–•–ª–µ–± –±–µ–ª—ã–π", price: 20 },
      { category: 'food', code: "F002", name: "–ú–æ–ª–æ–∫–æ", price: 45 },
      { category: 'food', code: "F003", name: "–Ø–π—Ü–∞", price: 60 },
      { category: 'food', code: "F004", name: "–ì—Ä–µ—á–∫–∞", price: 70 },
      { category: 'food', code: "F005", name: "–°–∞—Ö–∞—Ä", price: 80 },
      { category: 'food', code: "F006", name: "–°–æ–ª—å", price: 15 },
      { category: 'food', code: "F007", name: "–ú–∞—Å–ª–æ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–æ–µ", price: 120 },
      { category: 'food', code: "F008", name: "–¢–≤–æ—Ä–æ–≥", price: 90 },
      { category: 'food', code: "F009", name: "–°–º–µ—Ç–∞–Ω–∞", price: 55 },
      { category: 'food', code: "F010", name: "–ö–æ–ª–±–∞—Å–∞ –≤–∞—Ä–µ–Ω–∞—è", price: 250 },
      { category: 'food', code: "F011", name: "–°–æ—Å–∏—Å–∫–∏", price: 180 },
      { category: 'food', code: "F012", name: "–ö—É—Ä–∏–Ω—ã–µ –æ–∫–æ—Ä–æ—á–∫–∞", price: 190 },
      { category: 'food', code: "F013", name: "–ì–æ–≤—è–¥–∏–Ω–∞ –æ—Ç–±–∏–≤–Ω–∞—è", price: 350 },
      { category: 'food', code: "F014", name: "–§–∞—Ä—à —Å–º–µ—à–∞–Ω–Ω—ã–π", price: 280 },
      { category: 'food', code: "F015", name: "–°–æ—Å–∏—Å–∫–∏", price: 180 },
      { category: 'food', code: "F016", name: "–ö–æ–ª–±–∞—Å–∞ –¥–æ–∫—Ç–æ—Ä—Å–∫–∞—è", price: 270 },

      // –ê–ª–∫–æ–≥–æ–ª—å
      { category: 'alcohol', code: "A001", name: "–ó—É–±—Ä–æ–≤–∫–∞", price: 450 },
      { category: 'alcohol', code: "A002", name: "–ö—Ä–µ–º–ª—ë–≤—Å–∫–∞—è", price: 420 },
      { category: 'alcohol', code: "A003", name: "–ê–±—Å–æ–ª—é—Ç", price: 500 },
      { category: 'alcohol', code: "A004", name: "–†—É—Å—Å–∫–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç", price: 480 },
      { category: 'alcohol', code: "A005", name: "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ—Å–æ–±–∞—è", price: 430 },
      { category: 'alcohol', code: "A006", name: "–ü—à–µ–Ω–∏—á–Ω–∞—è", price: 410 },
      { category: 'alcohol', code: "A007", name: "–ö–∏–Ω–µ—à–µ–º—Å–∫–∞—è", price: 400 },
      { category: 'alcohol', code: "A008", name: "–†—É—Å—Å–∫–∞—è –≤–æ–¥–æ—á–∫–∞", price: 390 },
      { category: 'alcohol', code: "A009", name: "–†—É—Å—å", price: 460 },
      { category: 'alcohol', code: "A010", name: "–§–∏–Ω–ª—è–Ω–¥–∏—è", price: 510 },
      { category: 'alcohol', code: "A011", name: "–î–∂–∏–Ω Beefeater", price: 1200 },
      { category: 'alcohol', code: "A012", name: "–í–∏–Ω–æ –∫—Ä–∞—Å–Ω–æ–µ –∫—Ä–µ–ø–ª—ë–Ω–æ–µ", price: 350 },
      { category: 'alcohol', code: "A013", name: "–ü–∏–≤–æ –ñ–∏–≥—É–ª—ë–≤—Å–∫–æ–µ", price: 60 },
      { category: 'alcohol', code: "A014", name: "–ü–∏–≤–æ –ö–æ–∑–µ–ª", price: 70 },
      { category: 'alcohol', code: "A015", name: "–ö–æ–Ω—å—è–∫ –ê—Ä–∞—Ä–∞—Ç 3 –∑–≤–µ–∑–¥—ã", price: 700 },
      { category: 'alcohol', code: "A016", name: "–ö–æ–Ω—å—è–∫ –ö—Ä—ã–∂–Ω–µ–≤–∏—á–∏", price: 800 },
      { category: 'alcohol', code: "A017", name: "–í–∏–Ω–æ –±–µ–ª–æ–µ —Å—É—Ö–æ–µ", price: 450 },
      { category: 'alcohol', code: "A018", name: "–í–∏–Ω–æ –∫—Ä–∞—Å–Ω–æ–µ —Å—É—Ö–æ–µ", price: 480 },
      { category: 'alcohol', code: "A019", name: "–í–∏–Ω–æ –ø–æ–ª—É—Å–ª–∞–¥–∫–æ–µ", price: 400 },
      { category: 'alcohol', code: "A020", name: "–í–æ–¥–∫–∞ –†—É—Å—å", price: 460 },

      // –°–∏–≥–∞—Ä–µ—Ç—ã
      { category: 'cigarettes', code: "C001", name: "–ë–µ–ª–æ–º–æ—Ä–∫–∞–Ω–∞–ª", price: 65 },
      { category: 'cigarettes', code: "C002", name: "–î—ã–º–æ–∫", price: 68 },
      { category: 'cigarettes', code: "C003", name: "–ö–∞–∑–±–µ–∫", price: 70 },
      { category: 'cigarettes', code: "C004", name: "–°—Ç–æ–ª–∏—á–Ω—ã–µ", price: 75 },
      { category: 'cigarettes', code: "C005", name: "–ü—Ä–∏–º–∞", price: 72 },
      { category: 'cigarettes', code: "C006", name: "–°–µ–≤–µ—Ä", price: 67 },
      { category: 'cigarettes', code: "C007", name: "–ö—É—Ä—Å–∫", price: 69 },
      { category: 'cigarettes', code: "C008", name: "–†–æ—Å—Å–∏—è ‚Ññ1", price: 74 },
      { category: 'cigarettes', code: "C009", name: "–í—ã–º–ø–µ–ª", price: 71 },
      { category: 'cigarettes', code: "C010", name: "–ö—Ä—ã–∂–Ω–µ–≤–∏—á–∏", price: 73 },
      { category: 'cigarettes', code: "C011", name: "–ú–∞–ª—å–±–æ—Ä–æ", price: 120 },
      { category: 'cigarettes', code: "C012", name: "–ö–≠", price: 65 },
      { category: 'cigarettes', code: "C013", name: "Winston", price: 115 },
      { category: 'cigarettes', code: "C014", name: "Lucky Strike", price: 120 },
      { category: 'cigarettes', code: "C015", name: "Davidoff", price: 130 },
      { category: 'cigarettes', code: "C016", name: "Pall Mall", price: 100 },
      { category: 'cigarettes', code: "C017", name: "Camel", price: 110 },
      { category: 'cigarettes', code: "C018", name: "Parliament", price: 125 },
      { category: 'cigarettes', code: "C019", name: "Bond", price: 70 },
      { category: 'cigarettes', code: "C020", name: "–ü—Ä–∏–º–∞ –ú–µ–Ω—Ç–æ–ª", price: 73 },
    ];

    function generateProductButtons(category = 'food') {
      const container = document.getElementById("products-container");
      container.innerHTML = "";

      const filteredProducts = productsDB.filter(p => p.category === category);

      filteredProducts.forEach(product => {
        const btn = document.createElement("button");
        btn.textContent = `${product.name} ‚Äî ${product.price} ‚ÇΩ`;
        btn.onclick = () => addToCart(product.name, product.price);
        container.appendChild(btn);
      });

      // –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞
      document.querySelectorAll(".filters button").forEach(b => b.classList.remove("active"));
      document.querySelector(`.filters button[data-category="${category}"]`).classList.add("active");
    }

    function showCategory(cat) {
      generateProductButtons(cat);
    }

    function addToCart(name, price) {
      const existingItem = cart.find(item => item.name === name);
      if (existingItem) {
        existingItem.quantity += 1;
        existingItem.totalPrice = existingItem.price * existingItem.quantity;
      } else {
        cart.push({ name, price, quantity: 1, totalPrice: price });
      }
      updateCart();
    }

    function updateCart() {
      const itemsList = document.getElementById("cart-items");
      const totalEl = document.getElementById("total");
      itemsList.innerHTML = "";
      let total = 0;

      cart.forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = `${item.name} x${item.quantity} ‚Äî ${item.totalPrice} ‚ÇΩ`;

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "‚ùå";
        removeBtn.style.fontSize = "12px";
        removeBtn.style.background = "#ff5252";
        removeBtn.style.color = "white";
        removeBtn.style.border = "none";
        removeBtn.onclick = () => {
          cart.splice(index, 1);
          updateCart();
        };

        li.appendChild(removeBtn);
        itemsList.appendChild(li);
        total += item.totalPrice;
      });

      totalEl.textContent = total;
    }

    function loginCustomer() {
      const phone = document.getElementById("phoneInput").value.trim();
      if (!phone) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞");

      if (customers[phone]) {
        currentCustomer = phone;
        showCustomerInfo(customers[phone]);
      } else {
        customers[phone] = { points: 0, history: [] };
        localStorage.setItem("customers", JSON.stringify(customers));
        currentCustomer = phone;
        showCustomerInfo(customers[phone]);
      }
    }

    function showCustomerInfo(data) {
      document.getElementById("customerPhone").textContent = currentCustomer;
      document.getElementById("customerPoints").textContent = data.points;
      document.getElementById("customerInfo").style.display = "block";
    }

    function usePoints() {
      if (!currentCustomer) return;

      const customer = customers[currentCustomer];
      const pointsNeeded = 100;
      const discountAmount = 50;

      if (customer.points >= pointsNeeded) {
        customer.points -= pointsNeeded;
        customer.history.push({
          text: `–°–ø–∏—Å–∞–Ω–∏–µ ${pointsNeeded} –±–∞–ª–ª–æ–≤`,
          points: `-100`,
          date: new Date().toLocaleString()
        });
        localStorage.setItem("customers", JSON.stringify(customers));
        showCustomerInfo(customer);

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫–∏–¥–∫—É –≤ —á–µ–∫
        cart.push({
          name: "–°–∫–∏–¥–∫–∞ –ø–æ –±–∞–ª–ª–∞–º",
          price: -discountAmount,
          quantity: 1,
          totalPrice: -discountAmount
        });

        updateCart();
        alert(`‚úÖ –ë–∞–ª–ª—ã —Å–ø–∏—Å–∞–Ω—ã (-100) ‚Üí –°–∫–∏–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (-${discountAmount} ‚ÇΩ)`);
      } else {
        alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è");
      }
    }

    function checkout(paymentMethod) {
      if (cart.length === 0) {
        alert("–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ —á–µ–∫!");
        return;
      }

      const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);

      // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 1% –±–∞–ª–ª–æ–≤
      if (currentCustomer && total > 0) {
        const pointsToAdd = Math.floor(total * 0.01); // 1%
        customers[currentCustomer].points += pointsToAdd;
        customers[currentCustomer].history.push({
          text: `+${pointsToAdd} –∑–∞ –ø–æ–∫—É–ø–∫—É –Ω–∞ ${total} ‚ÇΩ`,
          points: pointsToAdd,
          date: new Date().toLocaleString()
        });
        localStorage.setItem("customers", JSON.stringify(customers));
        showCustomerInfo(customers[currentCustomer]);
      }

      alert(`‚úÖ –û–ø–ª–∞—á–µ–Ω–æ ${paymentMethod === 'cash' ? '–Ω–∞–ª–∏—á–Ω—ã–º–∏' : '–∫–∞—Ä—Ç–æ–π'}`);
      clearCart();
    }

    function clearCart() {
      cart = [];
      updateCart();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = () => {
      generateProductButtons("food"); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ü—Ä–æ–¥—É–∫—Ç—ã
    };
  </script>
</body>
</html>